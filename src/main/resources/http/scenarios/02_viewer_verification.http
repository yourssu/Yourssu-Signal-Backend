### 1. Issue verification code
POST {{host}}/api/viewers/verification
Authorization: Bearer {{accessToken}}
Content-Type: application/json

> {%
    client.test("Verification code issued", function() {
        client.assert(response.status === 200, "Response status is not 200");
        client.assert(response.body.result.verificationCode !== undefined, "Verification code is missing");
    });
    
    client.global.set("verificationCode", response.body.result.verificationCode);
    console.log("Verification code: " + response.body.result.verificationCode);
%}

###

### 2. Issue verification code for user 2
POST {{host}}/api/viewers/verification
Authorization: Bearer {{accessToken2}}
Content-Type: application/json

> {%
    client.test("Verification code issued", function() {
        client.assert(response.status === 200, "Response status is not 200");
        client.assert(response.body.result.verificationCode !== undefined, "Verification code is missing");
    });
    
    client.global.set("verificationCode2", response.body.result.verificationCode);
    console.log("User 2 verification code: " + response.body.result.verificationCode);
%}

###

### 3. Get viewer details
GET {{host}}/api/viewers/uuid
Authorization: Bearer {{accessToken}}

> {%
    client.test("Viewer details retrieved", function() {
        client.assert(response.status === 200, "Response status is not 200");
        client.assert(response.body.result.uuid === client.global.get("uuid"), "UUID mismatch");
    });
    
    console.log("Tickets: " + response.body.result.ticket);
    console.log("Used tickets: " + response.body.result.usedTicket);
%}

###

### 4. Get viewer details - User 2
GET {{host}}/api/viewers/uuid
Authorization: Bearer {{accessToken2}}

> {%
    client.test("Viewer details retrieved", function() {
        client.assert(response.status === 200, "Response status is not 200");
        client.assert(response.body.result.uuid === client.global.get("uuid2"), "UUID mismatch");
    });
    
    console.log("User 2 tickets: " + response.body.result.ticket);
    console.log("User 2 used tickets: " + response.body.result.usedTicket);
%}

###

### 5. Get all viewers (Admin only - dev environment)
GET {{host}}/api/viewers?secretKey={{accessKey}}

> {%
    client.test("All viewers retrieved", function() {
        client.assert(response.status === 200, "Response status is not 200");
        client.assert(Array.isArray(response.body.result), "Result is not an array");
    });
    
    console.log("Total viewers: " + response.body.result.length);
%}
